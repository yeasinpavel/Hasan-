<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HASAN TELECOM Vault</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={darkMode:'class'}</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>

<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 p-4 flex flex-col items-center gap-4">

<!-- HEADER -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900 p-6 rounded-3xl shadow text-center">
  <h1 class="text-3xl font-black text-blue-600">HASAN TELECOM</h1>
  <p id="modeIndicator" class="text-xs text-slate-400">STAFF VIEW MODE</p>

  <div class="flex justify-center gap-3 mt-4">
    <button onclick="toggleTheme()" class="p-3 rounded-xl bg-slate-100 dark:bg-slate-800">
      <span id="themeIcon">ðŸŒ™</span>
    </button>

    <button id="adminBtn" onclick="toggleAdmin()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold">
      LOGIN
    </button>

    <div id="adminTools" class="hidden flex gap-2">
      <button onclick="generatePDF()" class="bg-orange-600 p-3 rounded-xl text-white">ðŸ“„</button>
      <button onclick="logout()" class="bg-red-600 p-3 rounded-xl text-white">âœ•</button>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden w-full max-w-xl bg-white dark:bg-slate-900 p-4 rounded-3xl shadow space-y-3">
  <input id="brandInput" placeholder="Brand (Xiaomi)" class="w-full p-2 rounded bg-slate-100 dark:bg-slate-800">
  <input id="categoryInput" placeholder="Category (LCD)" class="w-full p-2 rounded bg-slate-100 dark:bg-slate-800">
  <input id="subCategoryInput" placeholder="Sub Category (AMOLED)" class="w-full p-2 rounded bg-slate-100 dark:bg-slate-800">
  <input id="modelInput" placeholder="Model (Redmi Note 10)" class="w-full p-2 rounded bg-slate-100 dark:bg-slate-800">
  <input id="priceInput" placeholder="Price (à§³ 3500)" class="w-full p-2 rounded bg-slate-100 dark:bg-slate-800">

  <select id="stockInput" class="w-full p-2 rounded bg-slate-100 dark:bg-slate-800">
    <option value="true">ðŸŸ¢ In Stock</option>
    <option value="false">ðŸ”´ Stock Out</option>
  </select>

  <button onclick="addItem()" class="w-full bg-blue-600 text-white py-2 rounded-xl font-bold">
    SAVE ITEM
  </button>
</div>

<!-- FILTER -->
<div class="w-full max-w-xl bg-white dark:bg-slate-900 p-4 rounded-3xl shadow">
  <input id="searchInput" onkeyup="render()" placeholder="Search..." class="w-full p-2 rounded bg-slate-100 dark:bg-slate-800">
</div>

<!-- LIST -->
<div id="vaultContent" class="w-full max-w-xl space-y-2"></div>
<div id="emptyState" class="hidden text-slate-400 italic">No items found</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyD2_M0SwhaQ90wuEVBdDP91zBc2GDWKglQ",
  authDomain: "hasan-telecom-ad91e.firebaseapp.com",
  databaseURL: "https://hasan-telecom-ad91e-default-rtdb.firebaseio.com",
  projectId: "hasan-telecom-ad91e",
  storageBucket: "hasan-telecom-ad91e.appspot.com",
  messagingSenderId: "199331841561",
  appId: "1:199331841561:web:3e2ef8bdb21f222ee5cc88"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* STATE */
const ADMIN_PASSWORD = "511436";
let isAdmin = false;
let data = [];

/* THEME */
function toggleTheme(){
  document.documentElement.classList.toggle("dark");
  document.getElementById("themeIcon").innerText =
    document.documentElement.classList.contains("dark") ? "â˜€ï¸" : "ðŸŒ™";
}
window.toggleTheme = toggleTheme;

/* LOGIN */
function toggleAdmin(){
  const key = prompt("Admin Password:");
  if(key === ADMIN_PASSWORD){
    isAdmin = true;
    adminPanel.classList.remove("hidden");
    adminTools.classList.remove("hidden");
    adminBtn.classList.add("hidden");
    modeIndicator.innerText = "ADMIN AUTHORIZED";
  } else alert("Wrong password");
}
function logout(){
  isAdmin = false;
  adminPanel.classList.add("hidden");
  adminTools.classList.add("hidden");
  adminBtn.classList.remove("hidden");
  modeIndicator.innerText = "STAFF VIEW MODE";
}
window.toggleAdmin = toggleAdmin;
window.logout = logout;

/* FIREBASE SYNC */
onValue(ref(db,"inventory"), snap=>{
  data = snap.val() ? Object.values(snap.val()) : [];
  render();
});

/* ADD ITEM */
function addItem(){
  const item = {
    id: Date.now().toString(),
    brand: brandInput.value,
    category: categoryInput.value,
    subCategory: subCategoryInput.value,
    model: modelInput.value,
    price: priceInput.value.startsWith("à§³") ? priceInput.value : "à§³ "+priceInput.value,
    inStock: stockInput.value==="true"
  };
  set(ref(db,"inventory/"+item.id), item);
}
window.addItem = addItem;

/* TOGGLE STOCK */
function toggleStock(id){
  const item = data.find(i=>i.id===id);
  item.inStock = !item.inStock;
  set(ref(db,"inventory/"+id), item);
}
window.toggleStock = toggleStock;

/* DELETE */
function deleteItem(id){
  if(confirm("Delete?")) remove(ref(db,"inventory/"+id));
}
window.deleteItem = deleteItem;

/* RENDER */
function render(){
  vaultContent.innerHTML="";
  const q = searchInput.value.toLowerCase();
  const filtered = data.filter(i =>
    (i.brand+i.category+i.model).toLowerCase().includes(q)
  );

  emptyState.classList.toggle("hidden", filtered.length>0);

  filtered.forEach(i=>{
    vaultContent.innerHTML+=`
      <div class="bg-white dark:bg-slate-900 p-3 rounded-xl shadow flex justify-between">
        <div>
          <b>${i.brand}</b> / ${i.category}<br>
          ${i.model} - <b>${i.price}</b>
        </div>
        <div onclick="toggleStock('${i.id}')" class="cursor-pointer">
          ${i.inStock?"ðŸŸ¢":"ðŸ”´"}
        </div>
        ${isAdmin?`<button onclick="deleteItem('${i.id}')" class="text-red-500">âœ•</button>`:""}
      </div>`;
  });
}
window.render = render;

/* PDF */
function generatePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("HASAN TELECOM INVENTORY",14,20);
  doc.autoTable({
    startY:30,
    head:[["Brand","Category","Model","Price","Stock"]],
    body:data.map(i=>[
      i.brand,i.category,i.model,i.price,i.inStock?"IN":"OUT"
    ])
  });
  doc.save("inventory.pdf");
}
window.generatePDF = generatePDF;
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
